<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø³ÙØ¬Ø§Ù„ | Ø¹ÙÙƒØ§Ø¸</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Amiri:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-gold: #c29547; --coffee-dark: #3e2723;
            --ivory-bg: #fdf5e6; --card-bg: #ffffff;
            --text-main: #3e2723; --clay-warm: #d84315;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            margin: 0; font-family: 'Cairo', sans-serif; 
            background: var(--ivory-bg); color: var(--text-main); 
            height: 100vh; overflow: hidden;
        }

        .screen { position: absolute; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; padding: 20px; transition: 0.3s; }
        .hidden { display: none !important; }

        .card { 
            background: var(--card-bg); padding: 30px; border-radius: 25px; 
            border: 2px solid var(--primary-gold); box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            text-align: center; width: 100%; max-width: 400px; 
        }

        h1 { font-family: 'Amiri', serif; font-size: 2.5rem; color: var(--primary-gold); margin: 0 0 20px 0; }

        .auth-tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 10px; border: 2px solid var(--primary-gold); border-radius: 10px; background: transparent; cursor: pointer; font-weight: bold; color: var(--primary-gold); }
        .tab-btn.active { background: var(--primary-gold); color: white; }

        input { width: 100%; padding: 12px; margin: 10px 0; border: 1.5px solid #ddd; border-radius: 10px; text-align: center; font-size: 1.1rem; }
        
        .main-btn { 
            background: var(--primary-gold); color: white; border: none; padding: 15px; border-radius: 12px; 
            font-size: 1.1rem; font-weight: bold; cursor: pointer; width: 100%; 
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .main-btn:disabled { background: #ccc; }

        .spinner { width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s linear infinite; display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats-bar { position: absolute; top: 20px; display: flex; gap: 10px; z-index: 100; }
        .stat-item { background: white; padding: 5px 15px; border-radius: 10px; border: 1px solid var(--primary-gold); font-weight: bold; }
    </style>
</head>
<body>

    <div id="auth-screen" class="screen">
        <div class="card">
            <h1>Ø³ÙØ¬Ø§Ù„</h1>
            <div class="auth-tabs">
                <button id="tab-login" class="tab-btn active" onclick="toggleAuth('login')">Ø¯Ø®ÙˆÙ„ (ID)</button>
                <button id="tab-reg" class="tab-btn" onclick="toggleAuth('reg')">ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
            </div>

            <div id="login-form">
                <input type="text" id="login-id" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù€ ID Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ">
                <button class="main-btn" id="btn-login" onclick="handleLogin()">
                    <div class="spinner" id="spin-login"></div>
                    <span id="txt-login">ğŸ“œ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¬Ù„Ø³</span>
                </button>
            </div>

            <div id="reg-form" class="hidden">
                <div id="step-1">
                    <input type="email" id="reg-email" placeholder="Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
                    <button class="main-btn" id="btn-send" onclick="handleSendCode()">
                        <div class="spinner" id="spin-send"></div>
                        <span id="txt-send">Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="main-menu" class="screen hidden">
        <div class="stats-bar">
            <div class="stat-item">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="m-points">0</span></div>
            <div class="stat-item">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª: <span id="m-attempts">0</span></div>
        </div>
        <div class="card">
            <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</h1>
            <p id="player-welcome"></p>
            <button class="main-btn" onclick="alert('Ø³ØªØ¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹!')">ğŸ® Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
            <button class="main-btn" style="background:#666; margin-top:10px" onclick="location.reload()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxLutalsPEehqIcn7JT45pnbS8ueNz83C7EHgyy-1tC6YaAp8PwMRc1wTBjIAl81_E/exec";
        let player = { id: '', points: 0, attempts: 0 };

        function toggleAuth(mode) {
            document.getElementById('login-form').classList.toggle('hidden', mode !== 'login');
            document.getElementById('reg-form').classList.toggle('hidden', mode !== 'reg');
            document.getElementById('tab-login').classList.toggle('active', mode === 'login');
            document.getElementById('tab-reg').classList.toggle('active', mode === 'reg');
        }

        // --- ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø­Ø³Ù†Ø© ---
        async function handleLogin() {
            const idVal = document.getElementById('login-id').value.trim();
            if(!idVal) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù€ ID");

            startLoading('btn-login', 'spin-login', 'txt-login', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©...');

            try {
                // Ù†Ø³ØªØ®Ø¯Ù… POST ÙˆÙ†Ø±Ø³Ù„ JSON ÙƒÙ…Ø§ ÙŠØªÙˆÙ‚Ø¹ Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'login', id: idVal })
                });
                
                const data = await response.json();

                if(data.result === "found") {
                    player.id = idVal;
                    player.points = data.points;
                    player.attempts = data.attempts;
                    
                    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
                    showDashboard();
                } else {
                    alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ø±Ù‘Ù (ID) ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ù„Ø¯ÙŠÙ†Ø§.");
                }
            } catch (error) {
                console.error(error);
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.");
            } finally {
                stopLoading('btn-login', 'spin-login', 'txt-login', 'ğŸ“œ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¬Ù„Ø³');
            }
        }

        function showDashboard() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('main-menu').classList.remove('hidden');
            document.getElementById('m-points').innerText = player.points;
            document.getElementById('m-attempts').innerText = player.attempts;
            document.getElementById('player-welcome').innerText = "Ø§Ù„Ù…Ø¹Ø±Ù Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ: " + player.id;
        }

        // Ø¯Ø§Ù„Ø© ØªØ´ØºÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function startLoading(btnId, spinId, txtId, msg) {
            document.getElementById(btnId).disabled = true;
            document.getElementById(spinId).style.display = 'block';
            document.getElementById(txtId).innerText = msg;
        }

        // Ø¯Ø§Ù„Ø© Ø¥ÙŠÙ‚Ø§Ù Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function stopLoading(btnId, spinId, txtId, msg) {
            document.getElementById(btnId).disabled = false;
            document.getElementById(spinId).style.display = 'none';
            document.getElementById(txtId).innerText = msg;
        }

        // (ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ØªØ¶Ø§Ù Ù‡Ù†Ø§ Ø¨Ù†ÙØ³ Ù…Ù†Ø·Ù‚ Ø§Ù„Ù€ Login)
        async function handleSendCode() {
            alert("Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§ØµÙŠØ© ØªØªØ·Ù„Ø¨ Ø¥Ø¹Ø¯Ø§Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª ÙÙŠ Ø§Ù„Ø³ÙƒØ±Ø¨Øª.");
        }
    </script>
</body>
</html>
